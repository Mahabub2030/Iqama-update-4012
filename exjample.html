<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WWW.KFIA.MANPOWER_LIST</title>

    <link rel="stylesheet" href="./data table/css/bootstrap.min.css">
    <link rel="stylesheet" href="./data table/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="Icon" href="./img/logo.jpg">
</head>

<body>
    <div class="p-lg-6 border-warning-subtle m-10 content font-serif-mono bg-gradient-to-r from-cyan-200 to-blue-300 rounded-lg shadow-2xl text-black ">
        <div class="row">
            <div class="col p-7">
                <div class="data_table">
                    <table id="example" class="table table-striped-columns table-hover">
                        <thead class="font-mono ">
                            <tr class="font-mono">
                                <th class="font-mono text-center text-xl"><h5>NAME</h5></th>
                                <th class="font-mono fw-bolder text-center text-xl"><h5>POSITION</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>DACO-ID</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>DACO-valid</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>IQAMA-Date</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>OLD_ID</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>SAP-ID</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>IQAMA-NUMBER</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>WORK_LOCATION</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>Iqama (Days)</h5></th>
                                <th class="fw-bolder text-center text-xl"><h5>DACO (Days)</h5></th>
                            </tr>
                        </thead>

                        <tbody class="font-mono">
                            <!-- Managment Stars here -->
                            <tr data-id="2" class="font-mono">
                                <td>Shoeib Abou Zeid Mahmoud Awad </td>
                                <td>Operation Manager</td>
                                <td>DMM-02-7825</td>
                                <td contenteditable="true" class="Daco-valid text-center text-lg">01-Jun-2024</td>
                                <td contenteditable="true" class="iqama-valid text-center text-lg">10-Aug-2024</td>
                                <td>0</td>
                                <td>401798</td>
                                <td>2254394725</td>
                                <td>MANAGMENT</td>
                                <td class="countdown-iqama-expire text-center text-lg"></td>
                                <td class="countdown-daco-expire text-center text-lg"></td>
                            </tr>
                            <tr data-id="2" class="font-mono">
                                <td>Shoeib Abou Zeid Mahmoud Awad </td>
                                <td>Operation Manager</td>
                                <td>DMM-02-7825</td>
                                <td contenteditable="true" class="Daco-valid text-center text-lg">01-Jun-2024</td>
                                <td contenteditable="true" class="iqama-valid text-center text-lg">10-Aug-2024</td>
                                <td>0</td>
                                <td>401798</td>
                                <td>2254394725</td>
                                <td>MANAGMENT</td>
                                <td class="countdown-iqama-expire text-center text-lg"></td>
                                <td class="countdown-daco-expire text-center text-lg"></td>
                            </tr>
                            <tr data-id="2" class="font-mono">
                                <td>Shoeib Abou Zeid Mahmoud Awad </td>
                                <td>Operation Manager</td>
                                <td>DMM-02-7825</td>
                                <td contenteditable="true" class="Daco-valid text-center text-lg">01-Jun-2024</td>
                                <td contenteditable="true" class="iqama-valid text-center text-lg">10-Aug-2024</td>
                                <td>0</td>
                                <td>401798</td>
                                <td>2254394725</td>
                                <td>MANAGMENT</td>
                                <td class="countdown-iqama-expire text-center text-lg"></td>
                                <td class="countdown-daco-expire text-center text-lg"></td>
                            </tr>
                            <tr data-id="2" class="font-mono">
                                <td>Shoeib Abou Zeid Mahmoud Awad </td>
                                <td>Operation Manager</td>
                                <td>DMM-02-7825</td>
                                <td contenteditable="true" class="Daco-valid text-center text-lg">Saudi</td>
                                <td contenteditable="true" class="iqama-valid text-center text-lg">10-Aug-2024</td>
                                <td>0</td>
                                <td>401798</td>
                                <td>2254394725</td>
                                <td>MANAGMENT</td>
                                <td class="countdown-iqama-expire text-center text-lg"></td>
                                <td class="countdown-daco-expire text-center text-lg"></td>
                            </tr>
                            <tr data-id="2" class="font-mono">
                                <td>Shoeib Abou Zeid Mahmoud Awad </td>
                                <td>Operation Manager</td>
                                <td>DMM-02-7825</td>
                                <td contenteditable="true" class="Daco-valid text-center text-lg">01-Jun-2024</td>
                                <td contenteditable="true" class="iqama-valid text-center text-lg">10-Aug-2024</td>
                                <td>0</td>
                                <td>401798</td>
                                <td>2254394725</td>
                                <td>MANAGMENT</td>
                                <td class="countdown-iqama-expire text-center text-lg"></td>
                                <td class="countdown-daco-expire text-center text-lg"></td>
                            </tr>
                            <tr data-id="2" class="font-mono">
                                <td>Shoeib Abou Zeid Mahmoud Awad </td>
                                <td>Operation Manager</td>
                                <td>DMM-02-7825</td>
                                <td contenteditable="true" class="Daco-valid text-center text-lg">01-Jun-2024</td>
                                <td contenteditable="true" class="iqama-valid text-center text-lg">10-Aug-2024</td>
                                <td>0</td>
                                <td>401798</td>
                                <td>2254394725</td>
                                <td>MANAGMENT</td>
                                <td class="countdown-iqama-expire text-center text-lg"></td>
                                <td class="countdown-daco-expire text-center text-lg"></td>
                            </tr>
                            <!-- Additional rows here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Include moment.js and moment-hijri.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-hijri/2.2.0/moment-hijri.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="./data table/js/bootstrap.bundle.min.js"></script>
    <script src="./data table/js/jquery-3.6.0.min.js"></script>
    <script src="./data table/js/datatables.min.js"></script>
    <script src="./data table/js/pdfmake.min.js"></script>
    <script src="./data table/js/vfs_fonts.js"></script>

    <script>
        $(document).ready(function () {
            // Update function for multiple dates
            function updateDaysRemaining() {
                $(".countdown-daco-expire").each(function () {
                    var dacoValidText = $(this).closest("tr").find(".Daco-valid").text();
                    var dacoValidDate = new Date(dacoValidText);
                    var currentDate = new Date();
                    if (isNaN(dacoValidDate.getTime())) {
                        $(this).text("N/A").addClass("text-danger").removeClass("text-success");
                    } else {
                        var diffInDays = Math.ceil((dacoValidDate - currentDate) / (1000 * 3600 * 24));
                        $(this).text(diffInDays).toggleClass("text-danger", diffInDays <= 0).toggleClass("text-success", diffInDays > 0);
                    }
                });

                $(".countdown-iqama-expire").each(function () {
                    var iqamaValidText = $(this).closest("tr").find(".iqama-valid").text();
                    if (iqamaValidText.toLowerCase().includes('id')) {
                        $(this).text("Saudi").addClass("text-success").removeClass("text-danger");
                    } else {
                        var iqamaValidDate = moment(iqamaValidText, 'iYYYY/iM/iD').isValid()
                            ? moment(iqamaValidText, 'iYYYY/iM/iD').toDate()
                            : new Date(iqamaValidText);
                        var currentDate = new Date();
                        var diffInDays = Math.ceil((iqamaValidDate - currentDate) / (1000 * 3600 * 24));
                        $(this).text(diffInDays).toggleClass("text-danger", diffInDays <= 0).toggleClass("text-success", diffInDays > 0);
                    }
                });
            }

            // Store dates in localStorage
            function saveDatesToStorage() {
                $(".Daco-valid, .iqama-valid").each(function () {
                    var rowId = $(this).closest("tr").attr("data-id");
                    localStorage.setItem('dacoValidDate_' + rowId, $(this).text());
                    localStorage.setItem('iqamaValidDate_' + rowId, $(this).text());
                });
            }

            // Excel export functionality
            function exportToExcel() {
                var wb = XLSX.utils.table_to_book(document.getElementById('example'), { sheet: "Sheet1" });
                XLSX.writeFile(wb, 'Manpower_List.xlsx');
            }

            // Bind contenteditable events
            $("td[contenteditable='true']").on("blur keyup paste input", function () {
                saveDatesToStorage();
                updateDaysRemaining();
            });

            // Retrieve dates on page load
            $(".Daco-valid, .iqama-valid").each(function () {
                var rowId = $(this).closest("tr").attr("data-id");
                var savedDaco = localStorage.getItem('dacoValidDate_' + rowId);
                var savedIqama = localStorage.getItem('iqamaValidDate_' + rowId);
                if (savedDaco) $(this).text(savedDaco);
                if (savedIqama) $(this).text(savedIqama);
            });

            // Initialize DataTable
            var table = $('#example').DataTable({
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });

            updateDaysRemaining();
            table.buttons().container().appendTo('#example_wrapper .col-md-6:eq(0)');
            $('#exportExcel').on('click', exportToExcel);
        });
    </script>
</body>

</html>
